# ç”Ÿæ´»å·¥å…·é›† - æ—©ç¡æ—©èµ·æ‰“å¡åº”ç”¨

ä¸€ä¸ªåŸºäº Next.js App Router æ„å»ºçš„ç”Ÿæ´»å·¥å…·é›†åº”ç”¨ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯ç¡çœ å‘¨æœŸè®°å½•å·¥å…·ã€‚è¯¥åº”ç”¨ä½¿ç”¨ Supabase è¿›è¡Œæ•°æ®å­˜å‚¨å’Œç”¨æˆ·è®¤è¯ï¼Œæ”¯æŒ Google å’Œ GitHub OAuth ç™»å½•ï¼Œå¹¶æä¾› PWAï¼ˆæ¸è¿›å¼Webåº”ç”¨ï¼‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- **OAuth æ— å¯†ç ç™»å½•**ï¼šé€šè¿‡ Google å’Œ GitHub å®ç°ç®€ä¾¿ç™»å½•
- **ç”¨æˆ·èµ„æ–™**ï¼šå±•ç¤ºç”¨æˆ·å¤´åƒå’Œç”¨æˆ·ä¿¡æ¯
- **ç¡çœ å‘¨æœŸè®°å½•**ï¼šè®°å½•å…¥ç¡å’Œèµ·åºŠæ—¶é—´ï¼Œæ”¯æŒè·¨æ—¥ç¡çœ 
- **æ™ºèƒ½é…å¯¹**ï¼šè‡ªåŠ¨å°†ç¡çœ å¼€å§‹å’Œç»“æŸäº‹ä»¶é…å¯¹æˆå®Œæ•´å‘¨æœŸ
- **å†å²è®°å½•**ï¼šæŸ¥çœ‹å†å²ç¡çœ æ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯
- **æ—¥å†è§†å›¾**ï¼šç›´è§‚å±•ç¤ºæ¯æ—¥ç¡çœ æƒ…å†µ
- **PWAæ”¯æŒ**ï¼šå¯å®‰è£…åˆ°æ¡Œé¢ï¼Œç¦»çº¿ä½¿ç”¨ï¼ŒåŸç”Ÿåº”ç”¨ä½“éªŒ

## PWA åŠŸèƒ½

ğŸš€ **å®‰è£…åˆ°æ¡Œé¢**ï¼šæ”¯æŒæ·»åŠ åˆ°æ‰‹æœº/ç”µè„‘æ¡Œé¢ï¼ŒåƒåŸç”ŸAppä¸€æ ·ä½¿ç”¨  
ğŸ“± **ç¦»çº¿ä½¿ç”¨**ï¼šæ— ç½‘ç»œæ—¶å¯æŸ¥çœ‹å·²ç¼“å­˜çš„ç¡çœ è®°å½•  
âš¡ **å¿«é€Ÿå¯åŠ¨**ï¼šä»æ¡Œé¢å›¾æ ‡ç›´æ¥å¯åŠ¨ï¼Œå…¨å±ä½“éªŒ  
ğŸ”„ **è‡ªåŠ¨æ›´æ–°**ï¼šåº”ç”¨æ›´æ–°åè‡ªåŠ¨è·å–æœ€æ–°ç‰ˆæœ¬  
ğŸ“¶ **ç½‘ç»œçŠ¶æ€æ£€æµ‹**ï¼šæ™ºèƒ½æç¤ºç½‘ç»œçŠ¶æ€å˜åŒ–  

è¯¦ç»†å®‰è£…å’Œä½¿ç”¨æŒ‡å—è¯·æŸ¥çœ‹ï¼š[PWA ä½¿ç”¨æŒ‡å—](./PWA_GUIDE.md)

## æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**ï¼šNext.js 15+ (App Router)
- **UI ç»„ä»¶åº“**ï¼šshadcn/ui + Tailwind CSS
- **çŠ¶æ€ç®¡ç†**ï¼šZustand
- **æ•°æ®è·å–**ï¼šTanStack Query (React Query)
- **åç«¯æœåŠ¡**ï¼šSupabase (PostgreSQL + Auth)
- **PWAæ”¯æŒ**ï¼š@ducanh2912/next-pwa + Workbox
- **è¯­è¨€**ï¼šTypeScript
- **å›¾æ ‡åº“**ï¼šLucide React + React Icons
- **æ—¥æœŸå¤„ç†**ï¼šdate-fns
- **é€šçŸ¥ç³»ç»Ÿ**ï¼šSonner

## å¦‚ä½•è¿è¡Œ

### å‰ç½®æ¡ä»¶

- Node.js 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- Yarn åŒ…ç®¡ç†å™¨
- Supabase è´¦å·å’Œé¡¹ç›®

### å®‰è£…æ­¥éª¤

1. å…‹éš†ä»“åº“ï¼š

```bash
git clone <ä»“åº“åœ°å€>
cd life-tools
```

2. å®‰è£…ä¾èµ–ï¼š

```bash
yarn install
```

3. åˆ›å»º `.env.local` æ–‡ä»¶å¹¶æ·»åŠ ç¯å¢ƒå˜é‡ï¼š

```env
# Supabase é…ç½®
NEXT_PUBLIC_SUPABASE_URL=<ä½ çš„Supabaseé¡¹ç›®URL>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<ä½ çš„SupabaseåŒ¿åå¯†é’¥>
NEXT_PUBLIC_AUTH_REDIRECT_URL=http://localhost:3000/auth/callback
```

4. è®¾ç½®æ•°æ®åº“ï¼ˆè§ä¸‹æ–¹ Supabase é…ç½®æŒ‡å—ï¼‰

5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š

```bash
yarn dev
```

6. æ‰“å¼€æµè§ˆå™¨è®¿é—® [http://localhost:3000](http://localhost:3000)

## Supabase é…ç½®æŒ‡å—

### æ•°æ®åº“è®¾ç½®

åœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­æ‰§è¡Œä»¥ä¸‹ SQL è¯­å¥æ¥åˆ›å»ºå¿…è¦çš„è¡¨å’Œæƒé™ï¼š

1. **åˆ›å»º Profiles è¡¨**ï¼š

```sql
-- åˆ›å»ºç”¨æˆ·é…ç½®æ–‡ä»¶è¡¨
create table public.profiles (
  id uuid references auth.users on delete cascade not null primary key,
  username text,
  avatar_url text,
  updated_at timestamp with time zone
);

-- å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥
alter table public.profiles enable row level security;

-- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„é…ç½®æ–‡ä»¶
create policy "Users can view own profile" on public.profiles
  for select using (auth.uid() = id);

create policy "Users can update own profile" on public.profiles
  for update using (auth.uid() = id);

-- ä¸ºæ–°ç”¨æˆ·è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªprofileè®°å½•
create function public.handle_new_user() 
returns trigger as $$
begin
  insert into public.profiles (id)
  values (new.id);
  return new;
end;
$$ language plpgsql security definer;

-- åˆ›å»ºè§¦å‘å™¨ä»¥åœ¨æ–°ç”¨æˆ·æ³¨å†Œæ—¶åˆ›å»ºprofile
create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();
```

2. **åˆ›å»ºç¡çœ è®°å½•è¡¨**ï¼š

```sql
-- åˆ›å»ºç¡çœ è®°å½•è¡¨
create table public.check_in_records (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null,
  timestamp bigint not null,
  type text not null check (type in ('sleep_start', 'sleep_end')),
  created_at timestamp with time zone default now()
);

-- æ·»åŠ å¤–é”®çº¦æŸ
alter table public.check_in_records 
add constraint fk_check_in_records_user_id 
foreign key (user_id) references auth.users(id) on delete cascade;

-- åˆ›å»ºç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½
create index idx_check_in_records_user_id on public.check_in_records(user_id);
create index idx_check_in_records_timestamp on public.check_in_records(timestamp);
create index idx_check_in_records_user_timestamp on public.check_in_records(user_id, timestamp desc);

-- å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥
alter table public.check_in_records enable row level security;

-- åˆ›å»ºRLSç­–ç•¥ - ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„è®°å½•
create policy "Users can view own check-in records" on public.check_in_records
  for select using (auth.uid() = user_id);

create policy "Users can insert own check-in records" on public.check_in_records
  for insert with check (auth.uid() = user_id);

create policy "Users can update own check-in records" on public.check_in_records
  for update using (auth.uid() = user_id);

create policy "Users can delete own check-in records" on public.check_in_records
  for delete using (auth.uid() = user_id);
```

### OAuth æä¾›å•†é…ç½®

1. åœ¨ Supabase æ§åˆ¶é¢æ¿ä¸­ï¼Œå¯¼èˆªåˆ° **è®¤è¯ > æä¾›å•†**

2. **é…ç½® Google OAuth**ï¼š
   - åœ¨ [Google Cloud Console](https://console.cloud.google.com/) åˆ›å»º OAuth å®¢æˆ·ç«¯
   - è®¾ç½®æˆæƒé‡å®šå‘ URIï¼š`https://[ä½ çš„é¡¹ç›®ID].supabase.co/auth/v1/callback`
   - å¤åˆ¶å®¢æˆ·ç«¯ ID å’Œå¯†é’¥åˆ° Supabase è®¾ç½®ä¸­

3. **é…ç½® GitHub OAuth**ï¼š
   - åœ¨ [GitHub å¼€å‘è€…è®¾ç½®](https://github.com/settings/developers) ä¸­åˆ›å»ºæ–°çš„ OAuth åº”ç”¨
   - è®¾ç½®æˆæƒå›è°ƒ URLï¼š`https://[ä½ çš„é¡¹ç›®ID].supabase.co/auth/v1/callback`
   - å¤åˆ¶å®¢æˆ·ç«¯ ID å’Œå¯†é’¥åˆ° Supabase è®¾ç½®ä¸­

### è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆRLSï¼‰è¯´æ˜

åº”ç”¨ä½¿ç”¨ Supabase çš„è¡Œçº§å®‰å…¨ç­–ç•¥ç¡®ä¿æ•°æ®å®‰å…¨ï¼š
- ç”¨æˆ·åªèƒ½æŸ¥çœ‹ã€åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤è‡ªå·±çš„è®°å½•
- æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½ç»è¿‡èº«ä»½éªŒè¯å’Œæˆæƒæ£€æŸ¥

## éƒ¨ç½²åˆ° Vercel

1. åœ¨ [Vercel](https://vercel.com) ä¸Šå¯¼å…¥é¡¹ç›®
2. æ·»åŠ ç¯å¢ƒå˜é‡ï¼ˆä¸ `.env.local` ä¸­ç›¸åŒï¼‰
3. éƒ¨ç½²åº”ç”¨
4. æ›´æ–° Supabase é¡¹ç›®çš„ç«™ç‚¹ URL å’Œé‡å®šå‘ URL ä¸ºç”Ÿäº§ç¯å¢ƒåŸŸå

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
life-tools/
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # åº”ç”¨è·¯ç”±å’Œé¡µé¢
â”‚   â”‚   â”œâ”€â”€ auth/               # è®¤è¯ç›¸å…³è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ callback/       # OAuth å›è°ƒå¤„ç†
â”‚   â”‚   â”œâ”€â”€ check-in/           # ç¡çœ è®°å½•åŠŸèƒ½é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ components/     # é¡µé¢ä¸“ç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts        # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx        # ä¸»é¡µé¢
â”‚   â”‚   â”œâ”€â”€ globals.css         # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # å…¨å±€å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx            # é¦–é¡µ
â”‚   â”‚   â””â”€â”€ providers.tsx       # å…¨å±€æä¾›è€…
â”‚   â”œâ”€â”€ components/             # å…±äº«ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ auth/               # è®¤è¯ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ui/                 # UI åŸºç¡€ç»„ä»¶ (shadcn/ui)
â”‚   â””â”€â”€ lib/                    # å·¥å…·åº“
â”‚       â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ hooks
â”‚       â”œâ”€â”€ stores/             # Zustand çŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ supabase.ts         # Supabase å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ supabase-server.ts  # æœåŠ¡ç«¯ Supabase å®¢æˆ·ç«¯
â”‚       â””â”€â”€ utils.ts            # å·¥å…·å‡½æ•°
â”œâ”€â”€ .env.local                  # ç¯å¢ƒå˜é‡ï¼ˆæœ¬åœ°ï¼‰
â”œâ”€â”€ components.json             # shadcn/ui é…ç½®
â”œâ”€â”€ next.config.ts              # Next.js é…ç½®
â”œâ”€â”€ package.json                # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ tailwind.config.ts          # Tailwind CSS é…ç½®
â””â”€â”€ tsconfig.json               # TypeScript é…ç½®
```

### ä¸»è¦æ–‡ä»¶è¯´æ˜

- **`src/app/check-in/types.ts`**: å®šä¹‰ç¡çœ è®°å½•ç›¸å…³çš„ TypeScript ç±»å‹
- **`src/lib/stores/useAuthStore.ts`**: ç”¨æˆ·è®¤è¯å’Œç¡çœ çŠ¶æ€ç®¡ç†
- **`src/lib/hooks/useCheckInRecords.ts`**: ç¡çœ è®°å½•æ•°æ®è·å–å’Œå¤„ç†é€»è¾‘

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
yarn dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
yarn build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
yarn start

# ä»£ç æ£€æŸ¥
yarn lint
```

## è®¸å¯è¯

[MIT License](LICENSE)
